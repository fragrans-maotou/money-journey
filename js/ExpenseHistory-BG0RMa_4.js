var e=Object.defineProperty,t=Object.defineProperties,a=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,o=(t,a,s)=>a in t?e(t,a,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[a]=s,i=(e,t)=>{for(var a in t||(t={}))l.call(t,a)&&o(e,a,t[a]);if(s)for(var a of s(t))n.call(t,a)&&o(e,a,t[a]);return e};import{d as r,c as u,e as c,f as d,i as v,g as p,t as m,y,z as g,r as D,o as b,A as x,L as h,I as f,J as k,x as A,F as w,m as C,N as I,p as S,u as F}from"./vue-vendor-GQR5GLLq.js";import{u as L}from"./useExpense-oBx4eHDE.js";import{_ as N}from"./index-DLCvt2vX.js";import"./useStorage-CghUNedP.js";const O={class:"expense-info"},j={class:"expense-details"},z={class:"expense-header"},E={class:"category-name"},T={class:"expense-time"},$={class:"expense-description"},_={class:"expense-actions"},P={class:"expense-amount"},U={key:0,class:"action-buttons"},V=N(r({__name:"ExpenseItem",props:{expense:{},category:{},showActions:{type:Boolean,default:!1},clickable:{type:Boolean,default:!0}},emits:["click","edit","delete"],setup(e,{emit:t}){const a=e,s=t,l=u(()=>a.category),n=e=>{const t=new Date,a=new Date(e);if(a.toDateString()===t.toDateString())return a.toLocaleTimeString("zh-CN",{hour:"2-digit",minute:"2-digit"});const s=new Date(t);return s.setDate(s.getDate()-1),a.toDateString()===s.toDateString()?"昨天":a.getFullYear()===t.getFullYear()?a.toLocaleDateString("zh-CN",{month:"short",day:"numeric"}):a.toLocaleDateString("zh-CN",{year:"numeric",month:"short",day:"numeric"})},o=()=>{a.clickable&&s("click",a.expense)},i=()=>{s("edit",a.expense)},r=()=>{s("delete",a.expense)};return(e,t)=>{var a,s,u;return d(),c("div",{class:"expense-item",onClick:o},[v("div",O,[v("div",{class:"category-icon",style:p({backgroundColor:(null==(a=l.value)?void 0:a.color)||"#95A5A6"})},m((null==(s=l.value)?void 0:s.icon)||"📝"),5),v("div",j,[v("div",z,[v("span",E,m((null==(u=l.value)?void 0:u.name)||"未知分类"),1),v("span",T,m(n(e.expense.date)),1)]),v("div",$,m(e.expense.description||"无备注"),1)])]),v("div",_,[v("div",P," ¥"+m(e.expense.amount.toFixed(2)),1),e.showActions?(d(),c("div",U,[v("button",{class:"edit-btn",onClick:g(i,["stop"]),type:"button"}," 编辑 "),v("button",{class:"delete-btn",onClick:g(r,["stop"]),type:"button"}," 删除 ")])):y("",!0)])])}}}),[["__scopeId","data-v-c14faf25"]]),Y={class:"expense-history"},B={class:"history-header"},q={class:"header-actions"},H={class:"search-section"},J={class:"search-input-wrapper"},M={key:0,class:"filter-tags"},G={key:0,class:"filter-tag"},K={key:1,class:"filter-tag"},Q={key:2,class:"filter-tag"},R={class:"statistics-overview"},W={class:"stat-item"},X={class:"stat-value"},Z={class:"stat-item"},ee={class:"stat-value"},te={class:"stat-item"},ae={class:"stat-value"},se={class:"expense-list-section"},le={key:0,class:"loading-state"},ne={key:1,class:"empty-state"},oe={key:2,class:"expense-list"},ie={class:"group-header"},re={class:"group-date"},ue={class:"group-total"},ce={class:"group-expenses"},de={class:"modal-content"},ve={class:"filter-group"},pe=["value"],me={class:"filter-group"},ye={class:"date-range-inputs"},ge={class:"filter-group"},De={class:"amount-range-inputs"},be={class:"modal-content"},xe={key:0,class:"expense-preview"},he={class:"preview-info"},fe={class:"preview-category"},ke={class:"preview-amount"},Ae={class:"preview-description"},we={key:3,class:"success-toast"},Ce={class:"toast-content"},Ie={class:"toast-message"},Se={key:4,class:"error-toast"},Fe={class:"toast-content"},Le={class:"toast-message"},Ne=N(r({__name:"ExpenseHistory",setup(e){const s=F(),{filteredExpenses:l,categories:n,currentFilter:o,isLoading:r,error:p,deleteExpense:N,setFilter:O,clearFilter:j,getCategoryById:z,clearError:E}=L(),T=D(""),$=D(!1),_=D(!1),P=D(null),U=D(!1),Ne=D(""),Oe=D({categoryId:"",startDate:"",endDate:"",minAmount:void 0,maxAmount:void 0}),je=u(()=>!!(o.value.categoryId||o.value.startDate||o.value.endDate||o.value.minAmount||o.value.maxAmount||T.value)),ze=u(()=>l.value.reduce((e,t)=>e+t.amount,0)),Ee=u(()=>l.value.length>0?ze.value/l.value.length:0),Te=u(()=>{const e=new Map;return l.value.forEach(t=>{try{const a=t.date instanceof Date?t.date:new Date(t.date);if(isNaN(a.getTime()))return;const s=a.toISOString().split("T")[0];e.has(s)||e.set(s,{date:s,dateLabel:$e(a),expenses:[],total:0});const l=e.get(s);l.expenses.push(t),l.total+=t.amount}catch(a){}}),Array.from(e.values()).sort((e,t)=>{const a=new Date(e.date);return new Date(t.date).getTime()-a.getTime()})}),$e=e=>{const t=new Date,a=e instanceof Date?e:new Date(e);if(a.toDateString()===t.toDateString())return"今天";const s=new Date(t);if(s.setDate(s.getDate()-1),a.toDateString()===s.toDateString())return"昨天";const l=new Date(t);if(l.setDate(t.getDate()-t.getDay()),a>=l){return["周日","周一","周二","周三","周四","周五","周六"][a.getDay()]}return a.getFullYear()===t.getFullYear()?a.toLocaleDateString("zh-CN",{month:"long",day:"numeric"}):a.toLocaleDateString("zh-CN",{year:"numeric",month:"long",day:"numeric"})},_e=e=>{const t=z(e);return(null==t?void 0:t.name)||"未知分类"},Pe=()=>{const e=(s=i({},o.value),l={description:T.value||void 0},t(s,a(l)));var s,l;O(e)},Ue=()=>{T.value="";const e=i({},o.value);delete e.description,O(e)},Ve=()=>{const{startDate:e,endDate:t}=o.value;return e&&t?`${e.toLocaleDateString("zh-CN")} - ${t.toLocaleDateString("zh-CN")}`:e?`从 ${e.toLocaleDateString("zh-CN")}`:t?`至 ${t.toLocaleDateString("zh-CN")}`:""},Ye=()=>{const{minAmount:e,maxAmount:t}=o.value;return void 0!==e&&void 0!==t?`¥${e} - ¥${t}`:void 0!==e?`≥ ¥${e}`:void 0!==t?`≤ ¥${t}`:""},Be=()=>{const e=i({},o.value);delete e.categoryId,O(e)},qe=()=>{const e=i({},o.value);delete e.startDate,delete e.endDate,O(e)},He=()=>{const e=i({},o.value);delete e.minAmount,delete e.maxAmount,O(e)},Je=()=>{T.value="",j()},Me=()=>{$.value=!1},Ge=()=>{Oe.value={categoryId:"",startDate:"",endDate:"",minAmount:void 0,maxAmount:void 0}},Ke=()=>{const e={};Oe.value.categoryId&&(e.categoryId=Oe.value.categoryId),Oe.value.startDate&&(e.startDate=new Date(Oe.value.startDate)),Oe.value.endDate&&(e.endDate=new Date(Oe.value.endDate)),void 0!==Oe.value.minAmount&&Oe.value.minAmount>0&&(e.minAmount=Oe.value.minAmount),void 0!==Oe.value.maxAmount&&Oe.value.maxAmount>0&&(e.maxAmount=Oe.value.maxAmount),T.value&&(e.description=T.value),O(e),Me()},Qe=e=>{s.push({path:"/expense-record",query:{edit:e.id}})},Re=e=>{P.value=e,_.value=!0},We=e=>{},Xe=()=>{_.value=!1,P.value=null},Ze=()=>{return e=null,t=null,a=function*(){if(P.value)try{yield N(P.value.id),Ne.value="消费记录已删除",et(),Xe()}catch(e){}},new Promise((s,l)=>{var n=e=>{try{i(a.next(e))}catch(t){l(t)}},o=e=>{try{i(a.throw(e))}catch(t){l(t)}},i=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,o);i((a=a.apply(e,t)).next())});var e,t,a},et=()=>{U.value=!0,setTimeout(()=>{U.value=!1},3e3)};return b(()=>{const e=o.value;Oe.value={categoryId:e.categoryId||"",startDate:e.startDate?(e.startDate instanceof Date?e.startDate:new Date(e.startDate)).toISOString().split("T")[0]:"",endDate:e.endDate?(e.endDate instanceof Date?e.endDate:new Date(e.endDate)).toISOString().split("T")[0]:"",minAmount:e.minAmount,maxAmount:e.maxAmount},e.description&&(T.value=e.description)}),x(p,e=>{e&&setTimeout(()=>{E()},5e3)}),(e,t)=>(d(),c("div",Y,[v("div",B,[t[11]||(t[11]=v("h1",null,"消费历史",-1)),v("div",q,[v("button",{class:"filter-btn",onClick:t[0]||(t[0]=e=>$.value=!0),type:"button"},[...t[10]||(t[10]=[v("span",{class:"filter-icon"},"🔍",-1),h(" 筛选 ",-1)])])])]),v("div",H,[v("div",J,[f(v("input",{"onUpdate:modelValue":t[1]||(t[1]=e=>T.value=e),type:"text",class:"search-input",placeholder:"搜索消费记录...",onInput:Pe},null,544),[[k,T.value]]),T.value?(d(),c("button",{key:0,class:"clear-search-btn",onClick:Ue,type:"button"}," ✕ ")):y("",!0)])]),je.value?(d(),c("div",M,[A(o).categoryId?(d(),c("div",G,[v("span",null,m(_e(A(o).categoryId)),1),v("button",{onClick:Be,type:"button"},"✕")])):y("",!0),A(o).startDate||A(o).endDate?(d(),c("div",K,[v("span",null,m(Ve()),1),v("button",{onClick:qe,type:"button"},"✕")])):y("",!0),A(o).minAmount||A(o).maxAmount?(d(),c("div",Q,[v("span",null,m(Ye()),1),v("button",{onClick:He,type:"button"},"✕")])):y("",!0),v("button",{class:"clear-all-filters",onClick:Je,type:"button"}," 清除所有筛选 ")])):y("",!0),v("div",R,[v("div",W,[t[12]||(t[12]=v("span",{class:"stat-label"},"总记录",-1)),v("span",X,m(A(l).length)+"笔",1)]),v("div",Z,[t[13]||(t[13]=v("span",{class:"stat-label"},"总金额",-1)),v("span",ee,"¥"+m(ze.value.toFixed(2)),1)]),v("div",te,[t[14]||(t[14]=v("span",{class:"stat-label"},"平均金额",-1)),v("span",ae,"¥"+m(Ee.value.toFixed(2)),1)])]),v("div",se,[A(r)?(d(),c("div",le,[...t[15]||(t[15]=[v("div",{class:"loading-spinner"},null,-1),v("span",null,"加载中...",-1)])])):0===A(l).length?(d(),c("div",ne,[t[16]||(t[16]=v("div",{class:"empty-icon"},"📝",-1)),v("h3",null,m(T.value?"没有找到匹配的记录":"暂无消费记录"),1),v("p",null,m(T.value?"尝试调整搜索条件":"开始记录您的第一笔消费吧"),1),T.value?y("",!0):(d(),c("button",{key:0,class:"add-expense-btn",onClick:t[2]||(t[2]=t=>e.$router.push("/expense-record")),type:"button"}," 添加消费记录 "))])):(d(),c("div",oe,[(d(!0),c(w,null,C(Te.value,e=>(d(),c("div",{key:e.date,class:"expense-group"},[v("div",ie,[v("span",re,m(e.dateLabel),1),v("span",ue,"¥"+m(e.total.toFixed(2)),1)]),v("div",ce,[(d(!0),c(w,null,C(e.expenses,e=>(d(),S(V,{key:e.id,expense:e,category:A(z)(e.categoryId),"show-actions":!0,onEdit:Qe,onDelete:Re,onClick:We},null,8,["expense","category"]))),128))])]))),128))]))]),$.value?(d(),c("div",{key:1,class:"filter-modal-overlay",onClick:Me},[v("div",{class:"filter-modal",onClick:t[8]||(t[8]=g(()=>{},["stop"]))},[v("div",{class:"modal-header"},[t[17]||(t[17]=v("h3",null,"筛选条件",-1)),v("button",{class:"close-btn",onClick:Me,type:"button"},"✕")]),v("div",de,[v("div",ve,[t[19]||(t[19]=v("label",{class:"filter-label"},"消费分类",-1)),f(v("select",{"onUpdate:modelValue":t[3]||(t[3]=e=>Oe.value.categoryId=e),class:"filter-select"},[t[18]||(t[18]=v("option",{value:""},"全部分类",-1)),(d(!0),c(w,null,C(A(n),e=>(d(),c("option",{key:e.id,value:e.id},m(e.icon)+" "+m(e.name),9,pe))),128))],512),[[I,Oe.value.categoryId]])]),v("div",me,[t[21]||(t[21]=v("label",{class:"filter-label"},"日期范围",-1)),v("div",ye,[f(v("input",{"onUpdate:modelValue":t[4]||(t[4]=e=>Oe.value.startDate=e),type:"date",class:"filter-input",placeholder:"开始日期"},null,512),[[k,Oe.value.startDate]]),t[20]||(t[20]=v("span",{class:"date-separator"},"至",-1)),f(v("input",{"onUpdate:modelValue":t[5]||(t[5]=e=>Oe.value.endDate=e),type:"date",class:"filter-input",placeholder:"结束日期"},null,512),[[k,Oe.value.endDate]])])]),v("div",ge,[t[23]||(t[23]=v("label",{class:"filter-label"},"金额范围",-1)),v("div",De,[f(v("input",{"onUpdate:modelValue":t[6]||(t[6]=e=>Oe.value.minAmount=e),type:"number",class:"filter-input",placeholder:"最小金额",min:"0",step:"0.01"},null,512),[[k,Oe.value.minAmount,void 0,{number:!0}]]),t[22]||(t[22]=v("span",{class:"amount-separator"},"至",-1)),f(v("input",{"onUpdate:modelValue":t[7]||(t[7]=e=>Oe.value.maxAmount=e),type:"number",class:"filter-input",placeholder:"最大金额",min:"0",step:"0.01"},null,512),[[k,Oe.value.maxAmount,void 0,{number:!0}]])])])]),v("div",{class:"modal-actions"},[v("button",{class:"reset-btn",onClick:Ge,type:"button"}," 重置 "),v("button",{class:"apply-btn",onClick:Ke,type:"button"}," 应用筛选 ")])])])):y("",!0),_.value?(d(),c("div",{key:2,class:"delete-modal-overlay",onClick:Xe},[v("div",{class:"delete-modal",onClick:t[9]||(t[9]=g(()=>{},["stop"]))},[t[25]||(t[25]=v("div",{class:"modal-header"},[v("h3",null,"确认删除")],-1)),v("div",be,[t[24]||(t[24]=v("p",null,"确定要删除这条消费记录吗？",-1)),P.value?(d(),c("div",xe,[v("div",he,[v("span",fe,m(_e(P.value.categoryId)),1),v("span",ke,"¥"+m(P.value.amount.toFixed(2)),1)]),v("div",Ae,m(P.value.description||"无备注"),1)])):y("",!0)]),v("div",{class:"modal-actions"},[v("button",{class:"cancel-btn",onClick:Xe,type:"button"}," 取消 "),v("button",{class:"confirm-delete-btn",onClick:Ze,type:"button"}," 删除 ")])])])):y("",!0),U.value?(d(),c("div",we,[v("div",Ce,[t[26]||(t[26]=v("span",{class:"toast-icon"},"✓",-1)),v("span",Ie,m(Ne.value),1)])])):y("",!0),A(p)?(d(),c("div",Se,[v("div",Fe,[t[27]||(t[27]=v("span",{class:"toast-icon"},"✕",-1)),v("span",Le,m(A(p)),1)])])):y("",!0)]))}}),[["__scopeId","data-v-44424f2a"]]);export{Ne as default};
