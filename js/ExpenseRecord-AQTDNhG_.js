var e=(e,a,l)=>new Promise((t,s)=>{var o=e=>{try{u(l.next(e))}catch(a){s(a)}},n=e=>{try{u(l.throw(e))}catch(a){s(a)}},u=e=>e.done?t(e.value):Promise.resolve(e.value).then(o,n);u((l=l.apply(e,a)).next())});import{d as a,r as l,c as t,A as s,e as o,f as n,i as u,y as c,L as d,F as i,m as r,x as v,z as m,I as p,J as g,t as y,h as b,g as h,o as k,l as D,s as C,u as f}from"./vue-vendor-GQR5GLLq.js";import{u as w}from"./useExpense-oBx4eHDE.js";import{A as V}from"./AmountInput-kU8B6T6k.js";import{_ as x}from"./index-DLCvt2vX.js";import"./useStorage-CghUNedP.js";const I={class:"category-picker"},F={class:"picker-header"},M={class:"categories-grid"},A=["onClick"],E={class:"category-name"},B={class:"form-group"},_={class:"form-group"},$={class:"icon-grid"},j=["onClick"],Y={class:"form-group"},T={class:"color-grid"},S=["onClick"],U={class:"form-actions"},q=["disabled"],P=x(a({__name:"CategoryPicker",props:{modelValue:{},placeholder:{default:"请选择分类"}},emits:["update:modelValue","change"],setup(a,{emit:k}){const D=a,C=k,{categories:f,addCategory:V,isLoading:x}=w(),P=l(D.modelValue||""),H=l(!1),L=l({name:"",icon:"📝",color:"#95A5A6"}),O=["🍽️","🚗","🛍️","🎬","🏥","📚","📝","💰","🏠","⚡","📱","👕","🎮","✈️","🚌","🚇","⛽","🍕","☕","🍺","💊","🏃","🎵","📖","🎨","🔧","🎁","💄","🧴","🌟"],z=["#FF6B6B","#4ECDC4","#45B7D1","#96CEB4","#FFEAA7","#DDA0DD","#95A5A6","#E17055","#74B9FF","#A29BFE","#FD79A8","#FDCB6E","#6C5CE7","#00B894","#E84393","#2D3436","#636E72","#00CEC9"],J=t(()=>L.value.name.trim().length>0&&L.value.icon&&L.value.color),R=e=>{P.value=e,C("update:modelValue",e),C("change",e)},Z=()=>{H.value=!1,G()},G=()=>{L.value={name:"",icon:"📝",color:"#95A5A6"}},K=()=>e(null,null,function*(){if(J.value)try{const e=yield V(L.value);R(e.id),Z()}catch(e){}});return s(()=>D.modelValue,e=>{P.value=e||""}),(e,a)=>(n(),o("div",I,[u("div",F,[a[4]||(a[4]=u("h3",null,"选择分类",-1)),u("button",{class:"add-category-btn",onClick:a[0]||(a[0]=e=>H.value=!0),type:"button"},[...a[3]||(a[3]=[u("span",{class:"icon"},"+",-1),d(" 添加分类 ",-1)])])]),u("div",M,[(n(!0),o(i,null,r(v(f),e=>(n(),o("button",{key:e.id,class:b(["category-item",{active:P.value===e.id}]),onClick:a=>R(e.id),type:"button"},[u("div",{class:"category-icon",style:h({backgroundColor:e.color})},y(e.icon),5),u("span",E,y(e.name),1)],10,A))),128))]),H.value?(n(),o("div",{key:0,class:"modal-overlay",onClick:Z},[u("div",{class:"add-category-modal",onClick:a[2]||(a[2]=m(()=>{},["stop"]))},[u("div",{class:"modal-header"},[a[5]||(a[5]=u("h4",null,"添加新分类",-1)),u("button",{class:"close-btn",onClick:Z,type:"button"},"×")]),u("form",{onSubmit:m(K,["prevent"]),class:"add-category-form"},[u("div",B,[a[6]||(a[6]=u("label",null,"分类名称",-1)),p(u("input",{"onUpdate:modelValue":a[1]||(a[1]=e=>L.value.name=e),type:"text",placeholder:"请输入分类名称",maxlength:"10",required:""},null,512),[[g,L.value.name]])]),u("div",_,[a[7]||(a[7]=u("label",null,"选择图标",-1)),u("div",$,[(n(),o(i,null,r(O,e=>u("button",{key:e,type:"button",class:b(["icon-option",{active:L.value.icon===e}]),onClick:a=>L.value.icon=e},y(e),11,j)),64))])]),u("div",Y,[a[8]||(a[8]=u("label",null,"选择颜色",-1)),u("div",T,[(n(),o(i,null,r(z,e=>u("button",{key:e,type:"button",class:b(["color-option",{active:L.value.color===e}]),style:h({backgroundColor:e}),onClick:a=>L.value.color=e},null,14,S)),64))])]),u("div",U,[u("button",{type:"button",class:"cancel-btn",onClick:Z}," 取消 "),u("button",{type:"submit",class:"confirm-btn",disabled:!J.value||v(x)},y(v(x)?"添加中...":"确认添加"),9,q)])],32)])])):c("",!0)]))}}),[["__scopeId","data-v-dfaa8181"]]),H={class:"date-picker"},L={class:"date-info"},O={class:"date-label"},z={class:"date-value"},J={class:"picker-content"},R={class:"quick-select"},Z=["onClick"],G={class:"month-year-selector"},K={class:"month-year"},N={class:"month"},Q={class:"year"},W={class:"calendar-grid"},X={class:"weekday-header"},ee={class:"dates-grid"},ae=["disabled","onClick"],le=x(a({__name:"DatePicker",props:{modelValue:{},label:{default:"选择日期"},placeholder:{default:"请选择日期"},minDate:{},maxDate:{},disabled:{type:Boolean}},emits:["update:modelValue","change"],setup(e,{emit:a}){const d=e,v=a,p=l(!1),g=l(d.modelValue||new Date),h=l(new Date(g.value)),k=["日","一","二","三","四","五","六"],D=["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],C=[{label:"今天",getValue:()=>new Date},{label:"昨天",getValue:()=>{const e=new Date;return e.setDate(e.getDate()-1),e}},{label:"本周一",getValue:()=>{const e=new Date,a=e.getDay(),l=e.getDate()-a+(0===a?-6:1);return new Date(e.setDate(l))}},{label:"本月1号",getValue:()=>{const e=new Date;return new Date(e.getFullYear(),e.getMonth(),1)}}],f=t(()=>{if(!g.value)return d.placeholder;const e=g.value,a=new Date,l=new Date;if(l.setDate(l.getDate()-1),I(e,a))return"今天";if(I(e,l))return"昨天";const t=e.getMonth()+1,s=e.getDate(),o=e.getFullYear();return o===a.getFullYear()?`${t}月${s}日`:`${o}年${t}月${s}日`}),w=t(()=>D[h.value.getMonth()]),V=t(()=>h.value.getFullYear()),x=t(()=>{const e=[],a=h.value,l=a.getFullYear(),t=a.getMonth(),s=new Date(l,t,1),o=new Date(s);o.setDate(o.getDate()-s.getDay());for(let n=0;n<42;n++){const a=new Date(o);a.setDate(o.getDate()+n);const l=a.getMonth()===t,s=I(a,new Date),u=g.value&&I(a,g.value),c=F(a);e.push({date:new Date(a),day:a.getDate(),isCurrentMonth:l,isToday:s,isSelected:u,isDisabled:c,key:`${a.getFullYear()}-${a.getMonth()}-${a.getDate()}`})}return e}),I=(e,a)=>e.getFullYear()===a.getFullYear()&&e.getMonth()===a.getMonth()&&e.getDate()===a.getDate(),F=e=>!!(d.minDate&&e<d.minDate)||!!(d.maxDate&&e>d.maxDate),M=e=>!!g.value&&I(g.value,e.getValue()),A=()=>{const e=new Date(h.value);e.setMonth(e.getMonth()-1),h.value=e},E=()=>{const e=new Date(h.value);e.setMonth(e.getMonth()+1),h.value=e},B=()=>{p.value=!1},_=()=>{v("update:modelValue",g.value),v("change",g.value),B()};return s(()=>d.modelValue,e=>{e&&(g.value=new Date(e),h.value=new Date(e))}),(e,a)=>(n(),o("div",H,[u("div",{class:"date-display",onClick:a[0]||(a[0]=e=>p.value=!p.value)},[u("div",L,[u("span",O,y(e.label),1),u("span",z,y(f.value),1)]),a[2]||(a[2]=u("div",{class:"date-icon"},[u("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none"},[u("path",{d:"M8 2V6M16 2V6M3 10H21M5 4H19C20.1046 4 21 4.89543 21 6V20C21 21.1046 20.1046 22 19 22H5C3.89543 22 3 21.1046 3 20V6C3 4.89543 3.89543 4 5 4Z",stroke:"currentColor","stroke-width":"2","stroke-linecap":"round","stroke-linejoin":"round"})])],-1))]),p.value?(n(),o("div",{key:0,class:"picker-overlay",onClick:B},[u("div",{class:"picker-modal",onClick:a[1]||(a[1]=m(()=>{},["stop"]))},[u("div",{class:"picker-header"},[a[3]||(a[3]=u("h3",null,"选择日期",-1)),u("button",{class:"close-btn",onClick:B,type:"button"},"×")]),u("div",J,[u("div",R,[(n(),o(i,null,r(C,e=>u("button",{key:e.label,class:b(["quick-option",{active:M(e)}]),onClick:a=>(e=>{const a=e.getValue();F(a)||(g.value=a,h.value=new Date(a))})(e),type:"button"},y(e.label),11,Z)),64))]),u("div",G,[u("button",{class:"nav-btn",onClick:A,type:"button"},"‹"),u("div",K,[u("span",N,y(w.value),1),u("span",Q,y(V.value),1)]),u("button",{class:"nav-btn",onClick:E,type:"button"},"›")]),u("div",W,[u("div",X,[(n(),o(i,null,r(k,e=>u("div",{key:e,class:"weekday"},y(e),1)),64))]),u("div",ee,[(n(!0),o(i,null,r(x.value,e=>(n(),o("button",{key:e.key,class:b(["date-cell",{"other-month":!e.isCurrentMonth,today:e.isToday,selected:e.isSelected,disabled:e.isDisabled}]),disabled:e.isDisabled,onClick:a=>(e=>{F(e)||(g.value=new Date(e))})(e.date),type:"button"},y(e.day),11,ae))),128))])]),u("div",{class:"picker-actions"},[u("button",{class:"cancel-btn",onClick:B,type:"button"}," 取消 "),u("button",{class:"confirm-btn",onClick:_,type:"button"}," 确认 ")])])])])):c("",!0)]))}}),[["__scopeId","data-v-f8bc688c"]]),te={class:"expense-record"},se={class:"record-header"},oe={class:"record-content"},ne={class:"record-form"},ue={class:"form-group"},ce={class:"form-group"},de={key:0,class:"error-message"},ie={class:"form-group"},re={key:0,class:"error-message"},ve={class:"form-group"},me={class:"input-footer"},pe={key:0,class:"error-message"},ge={class:"char-count"},ye={class:"form-actions"},be=["disabled"],he={class:"today-summary"},ke={class:"summary-content"},De={class:"summary-item"},Ce={class:"value"},fe={class:"summary-item"},we={class:"value"},Ve={key:0,class:"today-expenses"},xe={class:"expense-list"},Ie=["onClick"],Fe={class:"expense-info"},Me={class:"expense-details"},Ae={class:"category-name"},Ee={class:"description"},Be={class:"expense-amount"},_e={key:0,class:"success-toast"},$e={class:"toast-content"},je={class:"toast-message"},Ye={key:1,class:"error-toast"},Te={class:"toast-content"},Se={class:"toast-message"},Ue=x(a({__name:"ExpenseRecord",setup(a){const d=D();f();const{addExpense:b,updateExpense:x,todayExpenses:I,todayTotal:F,getCategoryById:M,isLoading:A,error:E,clearError:B}=w(),_=l(!1),$=l(null),j=l(!1),Y=l(""),T=l({amount:0,categoryId:"",description:"",date:new Date}),S=l({}),U=t(()=>T.value.amount>0&&T.value.categoryId&&T.value.date&&0===Object.keys(S.value).length),q=e=>{const a=M(e);return(null==a?void 0:a.icon)||"📝"},H=e=>{const a=M(e);return(null==a?void 0:a.name)||"未知分类"},L=e=>{const a=M(e);return(null==a?void 0:a.color)||"#95A5A6"},O=()=>{T.value.amount<=0?S.value.amount="请输入有效的消费金额":T.value.amount>999999?S.value.amount="消费金额不能超过999,999元":delete S.value.amount},z=()=>{T.value.categoryId?delete S.value.categoryId:S.value.categoryId="请选择消费分类"},J=()=>{T.value.date?T.value.date>new Date?S.value.date="消费日期不能是未来日期":delete S.value.date:S.value.date="请选择消费日期"},R=()=>{T.value.description.length>100?S.value.description="备注不能超过100个字符":delete S.value.description},Z=()=>{T.value={amount:0,categoryId:"",description:"",date:new Date},S.value={},_.value=!1,$.value=null},G=()=>e(null,null,function*(){if(O(),z(),J(),R(),0===Object.keys(S.value).length)try{if(B(),_.value&&$.value)yield x($.value,{amount:T.value.amount,categoryId:T.value.categoryId,description:T.value.description,date:T.value.date}),Y.value="消费记录已更新",Q(),Z();else{yield b(T.value),Y.value="消费记录已添加",Q();const e=new Date;T.value={amount:0,categoryId:"",description:"",date:e}}}catch(e){}}),K=e=>{_.value=!0,$.value=e.id,T.value={amount:e.amount,categoryId:e.categoryId,description:e.description,date:new Date(e.date)},window.scrollTo({top:0,behavior:"smooth"})},N=()=>{Z()},Q=()=>{j.value=!0,setTimeout(()=>{j.value=!1},3e3)};return k(()=>{const e=d.query.edit;if(e){const a=I.value.find(a=>a.id===e);a&&K(a)}}),s(E,e=>{e&&setTimeout(()=>{B()},5e3)}),(e,a)=>(n(),o("div",te,[u("div",se,[u("h1",null,y(_.value?"编辑消费":"记录消费"),1),_.value?(n(),o("button",{key:0,class:"cancel-edit-btn",onClick:N,type:"button"}," 取消 ")):c("",!0)]),u("div",oe,[u("div",ne,[u("form",{onSubmit:m(G,["prevent"])},[u("div",ue,[a[5]||(a[5]=u("label",{class:"form-label"},"消费金额",-1)),C(V,{modelValue:T.value.amount,"onUpdate:modelValue":a[0]||(a[0]=e=>T.value.amount=e),placeholder:"请输入消费金额",error:S.value.amount,onBlur:O},null,8,["modelValue","error"])]),u("div",ce,[a[6]||(a[6]=u("label",{class:"form-label"},"消费分类",-1)),C(P,{modelValue:T.value.categoryId,"onUpdate:modelValue":a[1]||(a[1]=e=>T.value.categoryId=e),onChange:z},null,8,["modelValue"]),S.value.categoryId?(n(),o("div",de,y(S.value.categoryId),1)):c("",!0)]),u("div",ie,[a[7]||(a[7]=u("label",{class:"form-label"},"消费日期",-1)),C(le,{modelValue:T.value.date,"onUpdate:modelValue":a[2]||(a[2]=e=>T.value.date=e),label:"消费日期","max-date":new Date,onChange:J},null,8,["modelValue","max-date"]),S.value.date?(n(),o("div",re,y(S.value.date),1)):c("",!0)]),u("div",ve,[a[8]||(a[8]=u("label",{class:"form-label"},"消费备注",-1)),p(u("textarea",{"onUpdate:modelValue":a[3]||(a[3]=e=>T.value.description=e),class:"description-input",placeholder:"请输入消费备注（可选）",maxlength:"100",rows:"3",onBlur:R},null,544),[[g,T.value.description]]),u("div",me,[S.value.description?(n(),o("div",pe,y(S.value.description),1)):c("",!0),u("div",ge,y(T.value.description.length)+"/100 ",1)])]),u("div",ye,[u("button",{type:"submit",class:"submit-btn",disabled:!U.value||v(A)},y(v(A)?"保存中...":_.value?"更新记录":"添加记录"),9,be)])],32)]),u("div",he,[a[12]||(a[12]=u("h3",null,"今日消费概览",-1)),u("div",ke,[u("div",De,[a[9]||(a[9]=u("span",{class:"label"},"今日消费",-1)),u("span",Ce,"¥"+y(v(F).toFixed(2)),1)]),u("div",fe,[a[10]||(a[10]=u("span",{class:"label"},"消费笔数",-1)),u("span",we,y(v(I).length)+"笔",1)])]),v(I).length>0?(n(),o("div",Ve,[a[11]||(a[11]=u("h4",null,"今日记录",-1)),u("div",xe,[(n(!0),o(i,null,r(v(I).slice(0,3),e=>(n(),o("div",{key:e.id,class:"expense-item",onClick:a=>K(e)},[u("div",Fe,[u("div",{class:"category-icon",style:h({backgroundColor:L(e.categoryId)})},y(q(e.categoryId)),5),u("div",Me,[u("span",Ae,y(H(e.categoryId)),1),u("span",Ee,y(e.description||"无备注"),1)])]),u("div",Be," ¥"+y(e.amount.toFixed(2)),1)],8,Ie))),128))]),v(I).length>3?(n(),o("button",{key:0,class:"view-more-btn",onClick:a[4]||(a[4]=a=>e.$router.push("/expense-history")),type:"button"}," 查看更多记录 ")):c("",!0)])):c("",!0)])]),j.value?(n(),o("div",_e,[u("div",$e,[a[13]||(a[13]=u("span",{class:"toast-icon"},"✓",-1)),u("span",je,y(Y.value),1)])])):c("",!0),v(E)?(n(),o("div",Ye,[u("div",Te,[a[14]||(a[14]=u("span",{class:"toast-icon"},"✕",-1)),u("span",Se,y(v(E)),1)])])):c("",!0)]))}}),[["__scopeId","data-v-dcbc8739"]]);export{Ue as default};
